<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eksperimen Sel Volta Interaktif</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@400;500;600&family=Montserrat:wght@600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-light: linear-gradient(135deg, #f6e9ff 0%, #d9b8ff 50%, #8a63ff 100%);
            --text-dark: #dbeafe;
            --text-light: #07263a;
            --panel-dark: rgba(15, 23, 42, 0.85);
            --panel-light: rgba(255, 255, 255, 0.92);
            --accent-blue: #60a5fa;
            --accent-purple: #a78bfa;
            --success-green: #4ade80;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        body.light {
            background: var(--bg-light);
            color: var(--text-light);
        }

        body.paused svg * {
            animation-play-state: paused !important;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--panel-dark);
            backdrop-filter: blur(20px);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light .header {
            background: var(--panel-light);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .header-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Montserrat', sans-serif;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-dark);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light .btn-secondary {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        body.light .theme-toggle {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-light);
        }

        .container {
            margin-top: 80px;
            padding: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .intro-section {
            background: var(--panel-dark);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInUp 0.6s ease-out;
        }

        body.light .intro-section {
            background: var(--panel-light);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .intro-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-text {
            line-height: 1.8;
            opacity: 0.9;
        }

        .experiment-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .lab-area {
            background: var(--panel-dark);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            min-height: 700px;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        body.light .lab-area {
            background: var(--panel-light);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        #experimentCanvas {
            width: 100%;
            height: 600px;
            background: radial-gradient(circle at 50% 50%, rgba(30, 58, 138, 0.1), transparent);
            border-radius: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.light #experimentCanvas {
            background: radial-gradient(circle at 50% 50%, rgba(138, 99, 255, 0.05), transparent);
            border: 2px dashed rgba(0, 0, 0, 0.1);
        }

        .control-panel {
            background: var(--panel-dark);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        body.light .control-panel {
            background: var(--panel-light);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .panel-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metal-select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-dark);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        body.light .metal-select {
            background: rgba(0, 0, 0, 0.03);
            border: 2px solid rgba(0, 0, 0, 0.08);
            color: var(--text-light);
        }

        .metal-select option {
            background: #1e293b;
            color: white;
            padding: 10px;
        }

        body.light .metal-select option {
            background: white;
            color: #1e293b;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-action {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-start {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-start:disabled {
            background: rgba(100, 100, 100, 0.3);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            display: none;
        }

        .btn-pause.show {
            display: flex;
        }

        .btn-resume {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            display: none;
        }

        .btn-resume.show {
            display: flex;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .results-panel {
            background: var(--panel-dark);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInUp 0.6s ease-out 0.6s both;
        }

        body.light .results-panel {
            background: var(--panel-light);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent-blue);
        }

        body.light .result-item {
            background: rgba(0, 0, 0, 0.03);
        }

        .result-label {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            color: var(--accent-blue);
        }

        .voltage-display {
            text-align: center;
            padding: 25px;
            background: radial-gradient(circle, rgba(96, 165, 250, 0.15), transparent);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .voltage-value {
            font-size: 3rem;
            font-weight: 800;
            font-family: 'Space Mono', monospace;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            flex-direction: column;
            width: 100%;
        }

        .status-idle {
            background: rgba(100, 100, 100, 0.2);
            color: #94a3b8;
        }

        .status-running {
            background: rgba(16, 185, 129, 0.2);
            color: #4ade80;
        }

        .status-paused {
            background: rgba(245, 158, 11, 0.2);
            color: #fb923c;
        }

        .status-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
            display: none;
        }

        .status-running .progress-bar,
        .status-paused .progress-bar {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #10b981);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            margin-top: 20px;
            padding: 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow: hidden;
        }

        body.light .legend {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.15);
        }

        .legend-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 30px;
            flex: 1;
            background: transparent;
            border-right: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.2s ease;
            position: relative;
        }

        body.light .legend-item {
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        .legend-item:last-child {
            border-right: none;
        }

        .legend-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        body.light .legend-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            flex-shrink: 0;
            position: relative;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        .legend-text {
            font-size: 0.95rem;
            font-weight: 600;
            white-space: nowrap;
            letter-spacing: 0.3px;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--panel-dark);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light .modal-content {
            background: var(--panel-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .modal-text {
            opacity: 0.8;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        @media (max-width: 1024px) {
            .experiment-grid {
                grid-template-columns: 1fr;
            }
            .control-panel {
                order: -1;
            }
            .legend {
                flex-direction: column;
            }
            .legend-item {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.15);
                padding: 14px 20px;
            }
            body.light .legend-item {
                border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            }
            .legend-item:last-child {
                border-bottom: none;
            }
        }

        @media (max-width: 768px) {
            .legend-text {
                font-size: 0.85rem;
            }
            .legend-dot {
                width: 14px;
                height: 14px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-title">
            <span>‚ö°</span>
            <span>Eksperimen Sel Volta</span>
        </div>
        <div class="header-actions">
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">üåô</button>
            <a href="kerangka.html" class="btn btn-secondary">‚Üê Kembali</a>
        </div>
    </header>

    <div class="container">
        <section class="intro-section">
            <h1 class="intro-title">üî¨ Laboratorium Virtual Sel Volta</h1>
            <p class="intro-text">
                Selamat datang di eksperimen interaktif! Di sini, Anda akan merakit sel Volta sendiri dengan memilih logam elektroda dan larutan elektrolit. 
                Amati bagaimana elektron mengalir, tegangan yang dihasilkan, dan reaksi redoks yang terjadi. Mari kita mulai perjalanan elektrokimia Anda! ‚öóÔ∏è
            </p>
        </section>

        <div class="experiment-grid">
            <div class="lab-area">
                <div class="status-indicator status-idle" id="statusIndicator">
                    <div class="status-content">
                        <span class="status-dot"></span>
                        <span id="statusText">Siap untuk eksperimen</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                <div id="experimentCanvas"></div>
                
                <!-- Legend langsung di bawah gambar -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #fbbf24; box-shadow: 0 0 10px rgba(251, 191, 36, 0.6);"></div>
                        <span class="legend-text">Electron Flow</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #a78bfa; box-shadow: 0 0 10px rgba(167, 139, 250, 0.6);"></div>
                        <span class="legend-text">Cations (Salt Bridge)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #4ade80; box-shadow: 0 0 10px rgba(74, 222, 128, 0.6);"></div>
                        <span class="legend-text">Anions (Salt Bridge)</span>
                    </div>
                </div>
            </div>

            <div class="control-panel">
                <div class="panel-section">
                    <h3 class="section-title">üî© Pilih Elektroda Anoda (Oksidasi)</h3>
                    <select id="anodeSelect" class="metal-select">
                        <option value="">-- Pilih Elektroda Anoda --</option>
                        <option value="Zn">Seng (Zn) - E¬∞ = -0.76 V</option>
                        <option value="Fe">Besi (Fe) - E¬∞ = -0.44 V</option>
                        <option value="Pb">Timbal (Pb) - E¬∞ = -0.13 V</option>
                        <option value="Mg">Magnesium (Mg) - E¬∞ = -2.37 V</option>
                    </select>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">‚ö° Pilih Elektroda Katoda (Reduksi)</h3>
                    <select id="cathodeSelect" class="metal-select">
                        <option value="">-- Pilih Elektroda Katoda --</option>
                        <option value="Cu">Tembaga (Cu) - E¬∞ = +0.34 V</option>
                        <option value="Ag">Perak (Ag) - E¬∞ = +0.80 V</option>
                        <option value="Au">Emas (Au) - E¬∞ = +1.50 V</option>
                        <option value="Ni">Nikel (Ni) - E¬∞ = -0.25 V</option>
                    </select>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">‚öóÔ∏è Pilih Larutan Elektrolit</h3>
                    <select id="electrolyteSelect" class="metal-select">
                        <option value="">-- Pilih Elektrolit --</option>
                        <option value="H2SO4">Asam Sulfat (H‚ÇÇSO‚ÇÑ) - Elektrolit Kuat</option>
                        <option value="NaCl">Natrium Klorida (NaCl) - Elektrolit Kuat</option>
                        <option value="KOH">Kalium Hidroksida (KOH) - Elektrolit Kuat</option>
                        <option value="KCl">Kalium Klorida (KCl) - Jembatan Garam</option>
                    </select>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">üîã Kontrol Eksperimen</h3>
                    <div class="action-buttons">
                        <button class="btn btn-action btn-start" id="startBtn" disabled>
                            <span>‚ñ∂</span>
                            <span>Mulai Eksperimen</span>
                        </button>
                        <button class="btn btn-action btn-pause" id="pauseBtn">
                            <span>‚è∏</span>
                            <span>Pause</span>
                        </button>
                        <button class="btn btn-action btn-resume" id="resumeBtn">
                            <span>‚ñ∂</span>
                            <span>Lanjutkan</span>
                        </button>
                        <button class="btn btn-action btn-reset" id="resetBtn">
                            <span>üîÑ</span>
                            <span>Reset</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-panel">
            <h3 class="section-title">üìä Hasil Pengukuran</h3>
            
            <div class="voltage-display">
                <div class="result-label">Tegangan Sel (Voltage)</div>
                <div class="voltage-value" id="voltageValue">0.00 V</div>
            </div>

            <div class="result-item">
                <div class="result-label">Reaksi Anoda (Oksidasi)</div>
                <div class="result-value" id="anodeReaction">-</div>
            </div>

            <div class="result-item">
                <div class="result-label">Reaksi Katoda (Reduksi)</div>
                <div class="result-value" id="cathodeReaction">-</div>
            </div>

            <div class="result-item">
                <div class="result-label">Reaksi Sel Total</div>
                <div class="result-value" id="totalReaction">-</div>
            </div>

            <div class="result-item">
                <div class="result-label">Arah Aliran Elektron</div>
                <div class="result-value" id="electronFlow">-</div>
            </div>
        </div>
    </div>

    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-icon">üéâ</div>
            <h2 class="modal-title">Eksperimen Berhasil!</h2>
            <p class="modal-text">
                Selamat! Anda telah berhasil menyelesaikan eksperimen sel Volta. 
                Kuis interaktif sekarang sudah terbuka untuk menguji pemahaman Anda!
            </p>
            <a href="kuis.html" class="btn btn-primary">Lanjut ke Kuis üß†</a>
            <button class="btn btn-secondary" onclick="closeModal()" style="margin-top: 10px;">Coba Lagi</button>
        </div>
    </div>

    <script>
        // Theme Toggle
        (function() {
            const KEY = 'vv-theme';
            const toggle = document.getElementById('themeToggle');
            const saved = localStorage.getItem(KEY) || 'dark';
            
            function applyTheme(theme) {
                if (theme === 'light') {
                    document.body.classList.add('light');
                    toggle.textContent = '‚òÄÔ∏è';
                } else {
                    document.body.classList.remove('light');
                    toggle.textContent = 'üåô';
                }
                localStorage.setItem(KEY, theme);
            }
            
            applyTheme(saved);
            toggle.addEventListener('click', function() {
                const isLight = document.body.classList.contains('light');
                applyTheme(isLight ? 'dark' : 'light');
            });
        })();

        // Metal Data
        const metalData = {
            'Zn': { 
                potential: -0.76, 
                name: 'Seng', 
                symbol: 'Zn',
                gradient: ['#8b9cb5', '#4a5d7a'],
                ionColor: 'rgba(139, 156, 181, 0.25)'
            },
            'Fe': { 
                potential: -0.44, 
                name: 'Besi', 
                symbol: 'Fe',
                gradient: ['#6b7280', '#374151'],
                ionColor: 'rgba(107, 114, 128, 0.25)'
            },
            'Pb': { 
                potential: -0.13, 
                name: 'Timbal', 
                symbol: 'Pb',
                gradient: ['#52525b', '#27272a'],
                ionColor: 'rgba(82, 82, 91, 0.25)'
            },
            'Mg': { 
                potential: -2.37, 
                name: 'Magnesium', 
                symbol: 'Mg',
                gradient: ['#cbd5e1', '#94a3b8'],
                ionColor: 'rgba(203, 213, 225, 0.25)'
            },
            'Cu': { 
                potential: 0.34, 
                name: 'Tembaga', 
                symbol: 'Cu',
                gradient: ['#d97706', '#92400e'],
                ionColor: 'rgba(59, 130, 246, 0.3)'
            },
            'Ag': { 
                potential: 0.80, 
                name: 'Perak', 
                symbol: 'Ag',
                gradient: ['#d1d5db', '#9ca3af'],
                ionColor: 'rgba(209, 213, 219, 0.2)'
            },
            'Au': { 
                potential: 1.50, 
                name: 'Emas', 
                symbol: 'Au',
                gradient: ['#fbbf24', '#b45309'],
                ionColor: 'rgba(251, 191, 36, 0.2)'
            },
            'Ni': { 
                potential: -0.25, 
                name: 'Nikel', 
                symbol: 'Ni',
                gradient: ['#6b7280', '#374151'],
                ionColor: 'rgba(20, 184, 166, 0.3)'
            }
        };

        // State Management
        let selectedAnode = null;
        let selectedCathode = null;
        let selectedElectrolyte = null;
        let isRunning = false;
        let isPaused = false;
        let timeouts = [];
        let intervals = [];
        let bubbleOffset = 0;
        let bubbleAnimationFrame = null;

        // Element References
        const anodeSelect = document.getElementById('anodeSelect');
        const cathodeSelect = document.getElementById('cathodeSelect');
        const electrolyteSelect = document.getElementById('electrolyteSelect');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Event Listeners
        anodeSelect.addEventListener('change', () => {
            selectedAnode = anodeSelect.value;
            checkReadyToStart();
        });

        cathodeSelect.addEventListener('change', () => {
            selectedCathode = cathodeSelect.value;
            checkReadyToStart();
        });

        electrolyteSelect.addEventListener('change', () => {
            selectedElectrolyte = electrolyteSelect.value;
            checkReadyToStart();
        });

        startBtn.addEventListener('click', startExperiment);
        pauseBtn.addEventListener('click', pauseExperiment);
        resumeBtn.addEventListener('click', resumeExperiment);
        resetBtn.addEventListener('click', resetExperiment);

        function checkReadyToStart() {
            if (selectedAnode && selectedCathode && selectedElectrolyte && !isRunning) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        function setManagedTimeout(callback, delay) {
            const id = setTimeout(callback, delay);
            timeouts.push({ id, callback, delay, setTime: Date.now() });
            return id;
        }

        function setManagedInterval(callback, delay) {
            const id = setInterval(callback, delay);
            intervals.push({ id, callback, delay });
            return id;
        }

        function clearAllTimers() {
            timeouts.forEach(t => clearTimeout(t.id));
            intervals.forEach(i => clearInterval(i.id));
            if (bubbleAnimationFrame) {
                cancelAnimationFrame(bubbleAnimationFrame);
                bubbleAnimationFrame = null;
            }
            timeouts = [];
            intervals = [];
        }

        function pauseExperiment() {
            if (!isRunning || isPaused) return;
            
            isPaused = true;
            const pausedTime = Date.now();
            
            timeouts.forEach(t => clearTimeout(t.id));
            intervals.forEach(i => clearInterval(i.id));
            if (bubbleAnimationFrame) {
                cancelAnimationFrame(bubbleAnimationFrame);
                bubbleAnimationFrame = null;
            }
            
            document.body.classList.add('paused');
            
            updateStatus('paused', 'Eksperimen dijeda ‚è∏');
            pauseBtn.classList.remove('show');
            resumeBtn.classList.add('show');
            
            timeouts.forEach(t => t.pausedTime = pausedTime);
        }

        function resumeExperiment() {
            if (!isRunning || !isPaused) return;
            
            isPaused = false;
            const resumeTime = Date.now();
            
            document.body.classList.remove('paused');
            
            const newTimeouts = [];
            timeouts.forEach(t => {
                const elapsed = t.pausedTime - t.setTime;
                const remaining = t.delay - elapsed;
                if (remaining > 0) {
                    const id = setTimeout(t.callback, remaining);
                    newTimeouts.push({ ...t, id, setTime: resumeTime, delay: remaining });
                }
            });
            timeouts = newTimeouts;
            
            const newIntervals = [];
            intervals.forEach(i => {
                const id = setInterval(i.callback, i.delay);
                newIntervals.push({ ...i, id });
            });
            intervals = newIntervals;
            
            if (isRunning) {
                animateBubbles();
            }
            
            updateStatus('running', 'Eksperimen berlanjut... ‚ö°');
            resumeBtn.classList.remove('show');
            pauseBtn.classList.add('show');
        }

        function animateBubbles() {
            if (!isRunning || isPaused) return;
            
            bubbleOffset = (bubbleOffset + 0.5) % 100;
            
            const bubbles = document.querySelectorAll('.animated-bubble');
            bubbles.forEach((bubble, index) => {
                const baseY = parseFloat(bubble.dataset.baseY);
                const speed = parseFloat(bubble.dataset.speed);
                const newY = baseY - (bubbleOffset * speed) % 100;
                bubble.setAttribute('cy', newY);
            });
            
            bubbleAnimationFrame = requestAnimationFrame(animateBubbles);
        }

        function startExperiment() {
            if (isRunning) return;
            
            if (!selectedAnode || !selectedCathode) {
                alert('Pilih logam untuk anoda dan katoda!');
                return;
            }
            
            if (selectedAnode === selectedCathode) {
                alert('Anoda dan katoda harus menggunakan logam yang berbeda!');
                return;
            }

            const voltage = metalData[selectedCathode].potential - metalData[selectedAnode].potential;
            
            if (voltage <= 0) {
                alert(`‚ö†Ô∏è Reaksi tidak spontan!\n\nTegangan sel = ${voltage.toFixed(2)} V\n\nPilih kombinasi logam yang menghasilkan E¬∞sel positif.\nTips: Pilih katoda dengan potensial lebih tinggi dari anoda.`);
                return;
            }

            isRunning = true;
            isPaused = false;
            bubbleOffset = 0;
            
            startBtn.style.display = 'none';
            pauseBtn.classList.add('show');
            
            const progressFill = document.getElementById('progressFill');
            const totalDuration = 13500;
            
            let progress = 0;
            const progressInterval = setManagedInterval(() => {
                if (!isPaused) {
                    progress += 100 / (totalDuration / 100);
                    if (progress >= 100) progress = 100;
                    progressFill.style.width = progress + '%';
                }
            }, 100);

            setManagedTimeout(() => {
                if (!isPaused) {
                    updateStatus('running', 'Memasukkan elektroda... üî¨');
                    buildExperiment(selectedAnode, selectedCathode);
                    animateBubbles();
                }
            }, 500);

            setManagedTimeout(() => {
                if (!isPaused) {
                    updateStatus('running', 'Reaksi redoks dimulai... ‚öóÔ∏è');
                    animateVoltage(voltage);
                }
            }, 2500);

            setManagedTimeout(() => {
                if (!isPaused) {
                    updateStatus('running', 'Elektron mengalir... ‚ö°');
                    displayReactions(selectedAnode, selectedCathode, voltage);
                }
            }, 5500);

            setManagedTimeout(() => {
                if (!isPaused) {
                    updateStatus('running', 'Mengukur tegangan... üìä');
                }
            }, 9500);

            setManagedTimeout(() => {
                if (!isPaused) {
                    updateStatus('running', 'Eksperimen selesai! ‚úÖ');
                    localStorage.setItem('vv-kuis-unlocked', '1');
                    
                    setManagedTimeout(() => {
                        showSuccessModal();
                        progressFill.style.width = '0%';
                        clearAllTimers();
                    }, 500);
                }
            }, 13000);
        }

        function buildExperiment(anode, cathode) {
            const canvas = document.getElementById('experimentCanvas');
            const anodeMetal = metalData[anode];
            const cathodeMetal = metalData[cathode];
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('viewBox', '0 0 1000 600');
            svg.setAttribute('style', 'width: 100%; height: 100%; max-height: 600px;');
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            
            // Defs
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            
            // Anode gradient
            const anodeGrad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            anodeGrad.setAttribute('id', 'gradAnode');
            anodeGrad.setAttribute('x1', '0%');
            anodeGrad.setAttribute('y1', '0%');
            anodeGrad.setAttribute('x2', '0%');
            anodeGrad.setAttribute('y2', '100%');
            anodeGrad.innerHTML = `
                <stop offset="0%" stop-color="${anodeMetal.gradient[0]}" />
                <stop offset="100%" stop-color="${anodeMetal.gradient[1]}" />
            `;
            defs.appendChild(anodeGrad);
            
            // Cathode gradient
            const cathodeGrad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            cathodeGrad.setAttribute('id', 'gradCathode');
            cathodeGrad.setAttribute('x1', '0%');
            cathodeGrad.setAttribute('y1', '0%');
            cathodeGrad.setAttribute('x2', '0%');
            cathodeGrad.setAttribute('y2', '100%');
            cathodeGrad.innerHTML = `
                <stop offset="0%" stop-color="${cathodeMetal.gradient[0]}" />
                <stop offset="100%" stop-color="${cathodeMetal.gradient[1]}" />
            `;
            defs.appendChild(cathodeGrad);
            
            // Salt bridge gradient
            const saltGrad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            saltGrad.setAttribute('id', 'saltBridgeFill');
            saltGrad.setAttribute('x1', '0%');
            saltGrad.setAttribute('y1', '0%');
            saltGrad.setAttribute('x2', '100%');
            saltGrad.setAttribute('y2', '0%');
            saltGrad.innerHTML = `
                <stop offset="0%" stop-color="rgba(180, 160, 100, 0.6)" />
                <stop offset="50%" stop-color="rgba(160, 140, 80, 0.8)" />
                <stop offset="100%" stop-color="rgba(180, 160, 100, 0.6)" />
            `;
            defs.appendChild(saltGrad);
            
            // Glow filter
            const glowFilter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            glowFilter.setAttribute('id', 'glow');
            glowFilter.innerHTML = `
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            `;
            defs.appendChild(glowFilter);
            
            svg.appendChild(defs);
            
            // Wire path (curved)
            const wirePath1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            wirePath1.setAttribute('d', 'M 250 350 Q 250 100, 500 50 Q 750 100, 750 350');
            wirePath1.setAttribute('fill', 'none');
            wirePath1.setAttribute('stroke', '#4b5563');
            wirePath1.setAttribute('stroke-width', '8');
            wirePath1.setAttribute('stroke-linecap', 'round');
            svg.appendChild(wirePath1);
            
            const wirePath2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            wirePath2.setAttribute('d', 'M 250 350 Q 250 100, 500 50 Q 750 100, 750 350');
            wirePath2.setAttribute('fill', 'none');
            wirePath2.setAttribute('stroke', '#6b7280');
            wirePath2.setAttribute('stroke-width', '3');
            wirePath2.setAttribute('stroke-linecap', 'round');
            wirePath2.setAttribute('stroke-dasharray', '15, 10');
            svg.appendChild(wirePath2);
            
            // Voltmeter
            const voltmeterG = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            voltmeterG.setAttribute('transform', 'translate(420, 20)');
            
            const voltBody = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            voltBody.setAttribute('width', '160');
            voltBody.setAttribute('height', '70');
            voltBody.setAttribute('rx', '8');
            voltBody.setAttribute('fill', '#1e293b');
            voltBody.setAttribute('stroke', '#475569');
            voltBody.setAttribute('stroke-width', '3');
            voltmeterG.appendChild(voltBody);
            
            const voltValue = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            voltValue.setAttribute('id', 'voltmeterDisplay');
            voltValue.setAttribute('x', '80');
            voltValue.setAttribute('y', '32');
            voltValue.setAttribute('text-anchor', 'middle');
            voltValue.setAttribute('fill', '#ef4444');
            voltValue.setAttribute('font-family', 'Space Mono, monospace');
            voltValue.setAttribute('font-size', '24');
            voltValue.setAttribute('font-weight', 'bold');
            voltValue.textContent = '0.00 V';
            voltmeterG.appendChild(voltValue);
            
            const voltLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            voltLabel.setAttribute('x', '80');
            voltLabel.setAttribute('y', '55');
            voltLabel.setAttribute('text-anchor', 'middle');
            voltLabel.setAttribute('fill', '#94a3b8');
            voltLabel.setAttribute('font-size', '11');
            voltLabel.setAttribute('font-weight', '600');
            voltLabel.setAttribute('letter-spacing', '1');
            voltLabel.textContent = 'VOLTMETER';
            voltmeterG.appendChild(voltLabel);
            
            svg.appendChild(voltmeterG);
            
            // Salt Bridge
            const saltBridgeG = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            // U-shaped tube
            const saltBridgePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            saltBridgePath.setAttribute('d', 'M 330 300 L 330 180 Q 330 150, 360 150 L 640 150 Q 670 150, 670 180 L 670 300');
            saltBridgePath.setAttribute('fill', 'url(#saltBridgeFill)');
            saltBridgePath.setAttribute('stroke', '#a0916a');
            saltBridgePath.setAttribute('stroke-width', '4');
            saltBridgePath.setAttribute('opacity', '0.9');
            saltBridgeG.appendChild(saltBridgePath);
            
            // Inner shadow
            const saltInner = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            saltInner.setAttribute('d', 'M 345 300 L 345 185 Q 345 165, 365 165 L 635 165 Q 655 165, 655 185 L 655 300');
            saltInner.setAttribute('fill', 'none');
            saltInner.setAttribute('stroke', 'rgba(0,0,0,0.3)');
            saltInner.setAttribute('stroke-width', '2');
            saltBridgeG.appendChild(saltInner);
            
            // Label
            const saltLabel = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            saltLabel.setAttribute('x', '430');
            saltLabel.setAttribute('y', '140');
            saltLabel.setAttribute('width', '140');
            saltLabel.setAttribute('height', '28');
            saltLabel.setAttribute('rx', '6');
            saltLabel.setAttribute('fill', 'rgba(0,0,0,0.8)');
            saltBridgeG.appendChild(saltLabel);
            
            const saltText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            saltText.setAttribute('x', '500');
            saltText.setAttribute('y', '160');
            saltText.setAttribute('text-anchor', 'middle');
            saltText.setAttribute('fill', '#fde047');
            saltText.setAttribute('font-size', '14');
            saltText.setAttribute('font-weight', 'bold');
            saltText.textContent = 'Salt Bridge';
            saltBridgeG.appendChild(saltText);
            
            // Ions animation
            if (isRunning) {
                // Anions (green) - moving left
                for (let i = 0; i < 4; i++) {
                    const anion = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    anion.setAttribute('r', '5');
                    anion.setAttribute('fill', '#4ade80');
                    anion.setAttribute('filter', 'url(#glow)');
                    
                    const animMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                    animMotion.setAttribute('dur', '4s');
                    animMotion.setAttribute('repeatCount', 'indefinite');
                    animMotion.setAttribute('begin', `-${i * 1}s`);
                    animMotion.setAttribute('path', 'M 640 160 L 360 160 Q 340 160, 340 180 L 340 310');
                    
                    anion.appendChild(animMotion);
                    saltBridgeG.appendChild(anion);
                }
                
                // Cations (purple) - moving right
                for (let i = 0; i < 4; i++) {
                    const cation = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    cation.setAttribute('r', '5');
                    cation.setAttribute('fill', '#a78bfa');
                    cation.setAttribute('filter', 'url(#glow)');
                    
                    const animMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                    animMotion.setAttribute('dur', '4s');
                    animMotion.setAttribute('repeatCount', 'indefinite');
                    animMotion.setAttribute('begin', `-${i * 1}s`);
                    animMotion.setAttribute('path', 'M 360 160 L 640 160 Q 660 160, 660 180 L 660 310');
                    
                    cation.appendChild(animMotion);
                    saltBridgeG.appendChild(cation);
                }
            }
            
            svg.appendChild(saltBridgeG);
            
            // Left Beaker (Anode)
            const leftBeakerG = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            // Beaker outline
            const leftBeaker = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            leftBeaker.setAttribute('x', '130');
            leftBeaker.setAttribute('y', '200');
            leftBeaker.setAttribute('width', '240');
            leftBeaker.setAttribute('height', '350');
            leftBeaker.setAttribute('rx', '15');
            leftBeaker.setAttribute('fill', 'rgba(30, 41, 59, 0.4)');
            leftBeaker.setAttribute('stroke', 'rgba(100, 116, 139, 0.6)');
            leftBeaker.setAttribute('stroke-width', '3');
            leftBeakerG.appendChild(leftBeaker);
            
            // Liquid
            const leftLiquid = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            leftLiquid.setAttribute('x', '140');
            leftLiquid.setAttribute('y', '300');
            leftLiquid.setAttribute('width', '220');
            leftLiquid.setAttribute('height', '240');
            leftLiquid.setAttribute('rx', '10');
            leftLiquid.setAttribute('fill', anodeMetal.ionColor);
            leftBeakerG.appendChild(leftLiquid);
            
            // Electrode
            const leftElectrode = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            leftElectrode.setAttribute('x', '230');
            leftElectrode.setAttribute('y', '220');
            leftElectrode.setAttribute('width', '40');
            leftElectrode.setAttribute('height', '250');
            leftElectrode.setAttribute('rx', '8');
            leftElectrode.setAttribute('fill', 'url(#gradAnode)');
            leftElectrode.setAttribute('stroke', 'rgba(0,0,0,0.5)');
            leftElectrode.setAttribute('stroke-width', '2');
            leftBeakerG.appendChild(leftElectrode);
            
            // Bubbles
            if (isRunning) {
                const bubbleData = [
                    { cx: 200, baseY: 480, r: 4, speed: 1 },
                    { cx: 280, baseY: 500, r: 3, speed: 1.3 },
                    { cx: 240, baseY: 450, r: 5, speed: 0.9 }
                ];
                
                bubbleData.forEach(b => {
                    const bubble = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    bubble.setAttribute('class', 'animated-bubble');
                    bubble.setAttribute('cx', b.cx);
                    bubble.setAttribute('cy', b.baseY);
                    bubble.setAttribute('r', b.r);
                    bubble.setAttribute('fill', 'rgba(255,255,255,0.5)');
                    bubble.dataset.baseY = b.baseY;
                    bubble.dataset.speed = b.speed;
                    leftBeakerG.appendChild(bubble);
                });
            }
            
            svg.appendChild(leftBeakerG);
            
            // Anode label
            const anodeLabel1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            anodeLabel1.setAttribute('x', '250');
            anodeLabel1.setAttribute('y', '570');
            anodeLabel1.setAttribute('text-anchor', 'middle');
            anodeLabel1.setAttribute('fill', '#cbd5e1');
            anodeLabel1.setAttribute('font-size', '18');
            anodeLabel1.setAttribute('font-weight', 'bold');
            anodeLabel1.textContent = 'Anode';
            svg.appendChild(anodeLabel1);
            
            const anodeLabel2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            anodeLabel2.setAttribute('x', '250');
            anodeLabel2.setAttribute('y', '590');
            anodeLabel2.setAttribute('text-anchor', 'middle');
            anodeLabel2.setAttribute('fill', '#94a3b8');
            anodeLabel2.setAttribute('font-size', '14');
            anodeLabel2.textContent = '(-) Oxidation';
            svg.appendChild(anodeLabel2);
            
            // Right Beaker (Cathode)
            const rightBeakerG = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            const rightBeaker = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rightBeaker.setAttribute('x', '630');
            rightBeaker.setAttribute('y', '200');
            rightBeaker.setAttribute('width', '240');
            rightBeaker.setAttribute('height', '350');
            rightBeaker.setAttribute('rx', '15');
            rightBeaker.setAttribute('fill', 'rgba(30, 41, 59, 0.4)');
            rightBeaker.setAttribute('stroke', 'rgba(100, 116, 139, 0.6)');
            rightBeaker.setAttribute('stroke-width', '3');
            rightBeakerG.appendChild(rightBeaker);
            
            const rightLiquid = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rightLiquid.setAttribute('x', '640');
            rightLiquid.setAttribute('y', '300');
            rightLiquid.setAttribute('width', '220');
            rightLiquid.setAttribute('height', '240');
            rightLiquid.setAttribute('rx', '10');
            rightLiquid.setAttribute('fill', cathodeMetal.ionColor);
            rightBeakerG.appendChild(rightLiquid);
            
            const rightElectrode = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rightElectrode.setAttribute('x', '730');
            rightElectrode.setAttribute('y', '220');
            rightElectrode.setAttribute('width', '40');
            rightElectrode.setAttribute('height', '250');
            rightElectrode.setAttribute('rx', '8');
            rightElectrode.setAttribute('fill', 'url(#gradCathode)');
            rightElectrode.setAttribute('stroke', 'rgba(0,0,0,0.5)');
            rightElectrode.setAttribute('stroke-width', '2');
            rightBeakerG.appendChild(rightElectrode);
            
            if (isRunning) {
                const rightBubbleData = [
                    { cx: 700, baseY: 490, r: 3, speed: 1.2 },
                    { cx: 780, baseY: 470, r: 4, speed: 1 }
                ];
                
                rightBubbleData.forEach(b => {
                    const bubble = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    bubble.setAttribute('class', 'animated-bubble');
                    bubble.setAttribute('cx', b.cx);
                    bubble.setAttribute('cy', b.baseY);
                    bubble.setAttribute('r', b.r);
                    bubble.setAttribute('fill', 'rgba(255,255,255,0.5)');
                    bubble.dataset.baseY = b.baseY;
                    bubble.dataset.speed = b.speed;
                    rightBeakerG.appendChild(bubble);
                });
            }
            
            svg.appendChild(rightBeakerG);
            
            // Cathode label
            const cathodeLabel1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            cathodeLabel1.setAttribute('x', '750');
            cathodeLabel1.setAttribute('y', '570');
            cathodeLabel1.setAttribute('text-anchor', 'middle');
            cathodeLabel1.setAttribute('fill', '#cbd5e1');
            cathodeLabel1.setAttribute('font-size', '18');
            cathodeLabel1.setAttribute('font-weight', 'bold');
            cathodeLabel1.textContent = 'Cathode';
            svg.appendChild(cathodeLabel1);
            
            const cathodeLabel2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            cathodeLabel2.setAttribute('x', '750');
            cathodeLabel2.setAttribute('y', '590');
            cathodeLabel2.setAttribute('text-anchor', 'middle');
            cathodeLabel2.setAttribute('fill', '#94a3b8');
            cathodeLabel2.setAttribute('font-size', '14');
            cathodeLabel2.textContent = '(+) Reduction';
            svg.appendChild(cathodeLabel2);
            
            // Electrons
            if (isRunning) {
                const offsets = [0, 0.5, 1, 1.5, 2];
                offsets.forEach((offset) => {
                    const electron = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    electron.setAttribute('r', '7');
                    electron.setAttribute('fill', '#fbbf24');
                    electron.setAttribute('filter', 'url(#glow)');
                    
                    const animMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                    animMotion.setAttribute('dur', '3s');
                    animMotion.setAttribute('repeatCount', 'indefinite');
                    animMotion.setAttribute('path', 'M 250 350 Q 250 100, 500 50 Q 750 100, 750 350');
                    animMotion.setAttribute('begin', `-${offset}s`);
                    
                    electron.appendChild(animMotion);
                    svg.appendChild(electron);
                });
            }
            
            canvas.innerHTML = '';
            canvas.appendChild(svg);
        }

        function animateVoltage(targetVoltage) {
            const display = document.getElementById('voltageValue');
            const voltmeterDisplay = document.getElementById('voltmeterDisplay');
            let current = 0;
            const duration = 5000;
            const steps = 100;
            const step = targetVoltage / steps;
            const interval = duration / steps;
            
            const timer = setManagedInterval(() => {
                if (!isPaused) {
                    current += step;
                    if (current >= targetVoltage) {
                        current = targetVoltage;
                    }
                    const formatted = current.toFixed(2);
                    display.textContent = `${formatted} V`;
                    if (voltmeterDisplay) {
                        voltmeterDisplay.textContent = `${formatted} V`;
                        // Change color based on voltage
                        if (current > 0) {
                            voltmeterDisplay.setAttribute('fill', '#4ade80');
                        }
                    }
                }
            }, interval);
        }

        function displayReactions(anode, cathode, voltage) {
            const spontaneous = voltage > 0 ? '‚úÖ Spontan' : '‚ùå Tidak Spontan';
            
            document.getElementById('anodeReaction').innerHTML = 
                `${anode} ‚Üí ${anode}<sup>2+</sup> + 2e<sup>-</sup><br><small style="opacity:0.7">(Oksidasi di elektroda negatif)</small>`;
            
            document.getElementById('cathodeReaction').innerHTML = 
                `${cathode}<sup>2+</sup> + 2e<sup>-</sup> ‚Üí ${cathode}<br><small style="opacity:0.7">(Reduksi di elektroda positif)</small>`;
            
            document.getElementById('totalReaction').innerHTML = 
                `${anode} + ${cathode}<sup>2+</sup> ‚Üí ${anode}<sup>2+</sup> + ${cathode}<br><small style="opacity:0.7; color:${voltage > 0 ? '#4ade80' : '#ef4444'}">${spontaneous} (E¬∞sel = ${voltage.toFixed(2)} V)</small>`;
            
            document.getElementById('electronFlow').innerHTML = 
                `Dari ${metalData[anode].name} (anoda) ‚Üí ${metalData[cathode].name} (katoda)<br><small style="opacity:0.7">Melalui kawat penghubung eksternal</small>`;
        }

        function updateStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = `status-indicator status-${status}`;
            statusText.textContent = text;
        }

        function resetExperiment() {
            isRunning = false;
            isPaused = false;
            selectedAnode = null;
            selectedCathode = null;
            selectedElectrolyte = null;
            bubbleOffset = 0;
            
            clearAllTimers();
            document.body.classList.remove('paused');
            
            anodeSelect.value = '';
            cathodeSelect.value = '';
            electrolyteSelect.value = '';
            
            document.getElementById('experimentCanvas').innerHTML = '';
            document.getElementById('voltageValue').textContent = '0.00 V';
            document.getElementById('anodeReaction').innerHTML = '-';
            document.getElementById('cathodeReaction').innerHTML = '-';
            document.getElementById('totalReaction').innerHTML = '-';
            document.getElementById('electronFlow').innerHTML = '-';
            
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = '0%';
            }
            
            startBtn.style.display = 'flex';
            pauseBtn.classList.remove('show');
            resumeBtn.classList.remove('show');
            
            updateStatus('idle', 'Siap untuk eksperimen');
            checkReadyToStart();
        }

        function showSuccessModal() {
            document.getElementById('successModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('show');
            resetExperiment();
        }

        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        updateStatus('idle', 'Siap untuk eksperimen');
    </script>
</body>
</html>